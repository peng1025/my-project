webpackJsonp([5],{"+T4b":function(e,t){},Dd8w:function(e,t,r){"use strict";t.__esModule=!0;var i,o=r("woOf"),a=(i=o)&&i.__esModule?i:{default:i};t.default=a.default||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}},R4wc:function(e,t,r){var i=r("kM2E");i(i.S+i.F,"Object",{assign:r("To3L")})},To3L:function(e,t,r){"use strict";var i=r("lktj"),o=r("1kS7"),a=r("NpIQ"),s=r("sB3e"),l=r("MU5D"),n=Object.assign;e.exports=!n||r("S82l")(function(){var e={},t={},r=Symbol(),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach(function(e){t[e]=e}),7!=n({},e)[r]||Object.keys(n({},t)).join("")!=i})?function(e,t){for(var r=s(e),n=arguments.length,d=1,c=o.f,m=a.f;n>d;)for(var u,f=l(arguments[d++]),g=c?i(f).concat(c(f)):i(f),p=g.length,h=0;p>h;)m.call(f,u=g[h++])&&(r[u]=f[u]);return r}:n},V3tA:function(e,t,r){r("R4wc"),e.exports=r("FeBl").Object.assign},cV0U:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("BO1k"),o=r.n(i),a=r("Dd8w"),s=r.n(a),l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-row",[t("el-col",{staticClass:"pd10",attrs:{span:24}},[t("el-tree",{attrs:{data:this.orgTree,"node-key":"id","expand-on-click-node":!1,"highlight-current":!0,"default-expand-all":"",props:this.defaultProps},on:{"node-click":this.handleOrgClick}})],1)],1)},staticRenderFns:[]};var n=r("VU/8")({props:["orgTree","defaultProps"],methods:{handleOrgClick:function(e){this.$emit("getList",{id:e.ID,name:e.Name,pid:e.ParentID})}}},l,!1,function(e){r("okdh")},"data-v-49021eda",null).exports,d={props:["orgList","activeOrg","roleList","allOrgList"],data:function(){return{addFormVisible:!1,editFormVisible:!1,defaultRoleLoading:!1,tableFormat:[{prop:"Name",label:"名称",width:"150"},{prop:"Description",label:"描述"}],options:{button:!0,maxButtons:2},form:{parentid:"",roles:[],name:"",description:""},editform:{parentid:"",roles:[],oldroles:"",id:"",name:"",description:""},editpname:"无",activeIndex:"",rules:{parentid:[{required:!0,message:"请选择上级组织",trigger:"change"}],name:[{required:!0,message:"请输入组织名称",trigger:"blur"},{max:30,message:"组织名称不要超过 30 个字符",trigger:"blur"}],description:[{max:60,message:"描述不要超过 60 个字符",trigger:"blur"}]},show:{"添加组织":!1,"编辑组织":!1,"删除组织":!1},loadingBtnState:{addOrgState:!1,editOrgState:!1}}},created:function(){this.ifshow(this.show)},methods:{reload:function(){this.$emit("getOrgList"),this.$emit("getOrgTree")},reset:function(e){this.$refs[e].resetFields()},addOrgBefore:function(){this.form.parentid=this.activeOrg.id,this.addFormVisible=!0},addOrg:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loadingBtnState.addOrgState=!0,e.ajax("添加组织",e.form,e.addOrgCB)})},addOrgCB:function(e,t){this.loadingBtnState.addOrgState=!1,null===e?this.$message({message:t.msg,type:"error"}):(this.addFormVisible=!1,this.$message({type:"success",message:"添加成功!"}),this.reload())},editOrg:function(e,t){var r=this;this.defaultRoleLoading=!0;var i="",a=!0,s=!1,l=void 0;try{for(var n,d=o()(this.allOrgList);!(a=(n=d.next()).done);a=!0){var c=n.value;c.ID===e.ParentID&&(i=c.Name)}}catch(e){s=!0,l=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw l}}this.editpname=i||"无";var m=!1;this.ajax("默认角色",{id:e.ID},function(e,t){if(null===e)r.$message({message:t.msg,type:"error"});else if(m=!0,r.defaultRoleLoading=!1,e.data[0]){var i=e.data[0].RoleIDs.split(",");for(var o in i)i[o]=parseInt(i[o]);r.editform.oldroles=e.data[0].RoleIDs,r.editform.roles=i}else r.editform.oldroles="",r.editform.roles=[]}),m||(this.activeIndex=t,this.editform.parentid=e.ParentID,this.editform.id=e.ID,this.editform.name=e.Name,this.editform.description=e.Description,this.editFormVisible=!0)},noChange:function(){var e=this.orgList[this.activeIndex],t=this.editform;return e.Description===t.description&&t.oldroles===t.roles.join(",")&&e.Name===t.name&&e.ID===t.id&&(this.reset("editform"),this.activeIndex="",this.editFormVisible=!1,!0)},editOrgHandle:function(){var e=this;this.$refs.editform.validate(function(t){if(!t)return!1;e.noChange()||(e.loadingBtnState.editOrgState=!0,e.ajax("编辑组织",e.editform,function(t,r){e.loadingBtnState.editOrgState=!1,null===t?e.$message({message:r.msg,type:"error"}):(e.editFormVisible=!1,e.orgList[e.activeIndex].Name=e.editform.name,e.orgList[e.activeIndex].Description=e.editform.description,e.reset("editform"),e.activeIndex="",e.$emit("getOrgTree"),e.$message({type:"success",message:"修改成功!"}))}))})},removeOrg:function(e,t){var r=this;this.$confirm("确定要删除组织吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.ajax("删除组织",{id:e.ID},function(i,o){null===i?r.$message({message:o.msg,type:"error"}):(r.orgList.splice(t,1),r.$message({type:"success",message:"删除成功!"}),r.activeOrg.id===e.ID?r.$emit("removeActiveOrg"):r.reload())})}).catch(function(e){"cancel"!==e&&r.$message({type:"error",message:"系统错误,请联系管理员!"+e})})}},computed:{tableData:function(){var e=[],t=!0,r=!1,i=void 0;try{for(var a,l=o()(this.orgList);!(t=(a=l.next()).done);t=!0){var n=a.value,d=s()({},n);d.buttons=[{show:"编辑组织",type:"primary",icon:"el-icon-edit",title:"编辑",fun:"editOrg"},{show:"删除组织",type:"danger",icon:"el-icon-delete",title:"删除",fun:"removeOrg"}],e.push(d)}}catch(e){r=!0,i=e}finally{try{!t&&l.return&&l.return()}finally{if(r)throw i}}return e}}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-row",[r("el-col",{staticClass:"pd10",attrs:{span:4}},[r("span",{staticClass:"activeOrg"},[e._v("组织:"+e._s(e.activeOrg.name))])]),e._v(" "),r("el-col",{staticClass:"pd10",attrs:{span:8}},[e.show["添加组织"]?r("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:function(t){e.addOrgBefore()}}},[e._v("添加")]):e._e()],1)],1),e._v(" "),r("el-row",[r("el-col",{staticClass:"pd10",attrs:{span:24}},[r("my-table",{attrs:{tableFormat:e.tableFormat,data:e.tableData,options:e.options,show:e.show},on:{editOrg:e.editOrg,removeOrg:e.removeOrg}})],1)],1),e._v(" "),e.show["添加组织"]?r("el-dialog",{attrs:{title:"新增组织",visible:e.addFormVisible},on:{"update:visible":function(t){e.addFormVisible=t},close:function(t){e.reset("form")}}},[r("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"组织名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"上级组织",prop:"parentid"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择上级组织"},model:{value:e.form.parentid,callback:function(t){e.$set(e.form,"parentid",t)},expression:"form.parentid"}},e._l(e.allOrgList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"默认角色",prop:"roles"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择默认角色",multiple:""},model:{value:e.form.roles,callback:function(t){e.$set(e.form,"roles",t)},expression:"form.roles"}},e._l(e.roleList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"组织描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.addOrgState},on:{click:e.addOrg}},[e._v("保 存")])],1)],1):e._e(),e._v(" "),e.show["编辑组织"]?r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.defaultRoleLoading,expression:"defaultRoleLoading"}],attrs:{title:"编辑组织",visible:e.editFormVisible},on:{"update:visible":function(t){e.editFormVisible=t},close:function(t){e.reset("editform")}}},[r("el-form",{ref:"editform",attrs:{rules:e.rules,model:e.editform,"label-width":"80px"}},[r("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"上级组织"}},[r("span",[e._v(e._s(e.editpname))])]),e._v(" "),r("el-form-item",{attrs:{label:"组织名称",prop:"name"}},[r("el-input",{model:{value:e.editform.name,callback:function(t){e.$set(e.editform,"name",t)},expression:"editform.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"默认角色",prop:"roles"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择默认角色",multiple:""},model:{value:e.editform.roles,callback:function(t){e.$set(e.editform,"roles",t)},expression:"editform.roles"}},e._l(e.roleList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"组织描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.editform.description,callback:function(t){e.$set(e.editform,"description",t)},expression:"editform.description"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.editFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.editOrgState},on:{click:e.editOrgHandle}},[e._v("保 存")])],1)],1):e._e()],1)},staticRenderFns:[]};var m=r("VU/8")(d,c,!1,function(e){r("+T4b")},"data-v-731220ab",null).exports,u=Vue.filter("formatDate"),f=Vue.filter("formatAccountType"),g=Vue.filter("formatStatus"),p={props:["userList","userCount","activeOrg","orgList","roleList","defaultRole"],data:function(){return{addFormVisible:!1,orgFormVisible:!1,editFormVisible:!1,statusFormVisible:!1,roleFormVisible:!1,pageindex:1,pagesize:10,empType:[],accountType:[],form:{name:"",username:"",jobno:"",status:"",ismanage:""},addform:{orgid:"",name:"",username:"",status:"",type:"",roles:[],jobno:""},statusform:{status:"",uids:[]},orgform:{orgid:"",uids:[]},roleform:{id:"",roles:[]},roletext:{name:""},editform:{orgid:"",id:"",name:"",username:"",status:"",type:"",jobno:""},activeIndex:"",rules:{orgid:[{required:!0,message:"请选择所属组织",trigger:"change"}],status:[{required:!0,message:"请选择入职状态",trigger:"change"}],type:[{required:!0,message:"请选择账号类型",trigger:"change"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{validator:function(e,t,r){/(^[\u4e00-\u9fa5]{1,19}$)/.test(t)?r():r(new Error("请输入2到20字符,中文!"))},trigger:"blur"}],username:[{required:!0,message:"请输入账号",trigger:"blur"},{validator:function(e,t,r){/^[a-zA-z]\w{1,19}$/.test(t)?r():r(new Error("请输入2到20字符,数字字母下划线,以字母开头!"))},trigger:"blur"}],jobno:[{required:!0,message:"请输入工号",trigger:"blur"},{max:12,message:"工号不要超过 12 个字符",trigger:"blur"}]},show:{"添加用户":!1,"编辑用户":!1,"删除用户":!1,"变更用户状态":!1,"变更用户组织":!1,"设置角色":!1,"组织用户列表":!1},tableFormat:[{prop:"Name",label:"姓名",width:"150"},{prop:"UserName",label:"账号",width:"150"},{prop:"OrgIDStr",label:"组织",width:"150"},{prop:"JobNO",label:"工号",width:"150"},{prop:"RoleNames",label:"角色",width:"150"},{prop:"IsManageStr",label:"账号类型",width:"150"},{prop:"StatusStr",label:"入职状态",width:"150"},{prop:"CreateBy",label:"创建人",width:"150"},{prop:"CreateTimeStr",label:"创建时间",width:"180"},{prop:"UpdateBy",label:"修改人",width:"150"},{prop:"UpdateTimeStr",label:"修改时间",width:"180"},{prop:"LastLoginTimeStr",label:"最后登录时间",width:"180"}],options:{selection:!0,multipleSelection:[],multipleSelectionIndex:[],button:!0,maxButtons:3},loadingBtnState:{searchState:!1,addState:!1,editState:!1,changeStatusState:!1,changeOrgState:!1,changeRoleState:!1}}},created:function(){this.init()},mounted:function(){this.reload()},methods:{currentChange:function(e){this.pageindex=e||1,this.reload()},init:function(){var e=this;this.ifshow(this.show),this.getDic("入职状态",function(t){e.empType=t}),this.getDic("账号类型",function(t){e.accountType=t})},reload:function(){var e=(this.pageindex-1)*this.pagesize,t={};for(var r in this.form)""!==this.form[r]&&(t[r]=this.form[r]);this.$emit("searchUser",s()({start:e,size:this.pagesize},t))},confirmClose:function(e){this.$confirm("确定要关闭弹出框吗?").then(function(){e()}).catch(function(e){})},resetForm:function(e){this.$refs[e].resetFields()},addBefore:function(){this.addform.orgid=this.activeOrg.id,this.addform.roles=this.defaultRole,this.addFormVisible=!0},addUser:function(){var e=this;this.$refs.addform.validate(function(t){if(!t)return!1;e.loadingBtnState.addState=!0,e.ajax("添加用户",e.addform,function(t,r){e.loadingBtnState.addState=!1,null===t?e.$message({message:r.msg,type:"error"}):(e.addFormVisible=!1,e.$message({type:"success",message:"添加成功!"}),e.reload())})})},changeStatusBefore:function(){this.options.multipleSelection.length>0?(this.statusform.uids=this.options.multipleSelection,this.statusFormVisible=!0):this.$message({type:"warning",message:"请选择要变更状态的用户!"})},changeStatus:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loadingBtnState.changeStatusState=!0,e.ajax("变更用户状态",e.statusform,function(t,r){if(e.loadingBtnState.changeStatusState=!1,null===t)e.$message({message:r.msg,type:"error"});else{e.statusFormVisible=!1;var i=!0,a=!1,s=void 0;try{for(var l,n=o()(e.options.multipleSelectionIndex);!(i=(l=n.next()).done);i=!0){var d=l.value;e.userList[d].Status=e.statusform.status}}catch(r){a=!0,s=r}finally{try{!i&&n.return&&n.return()}finally{if(a)throw s}}e.resetForm("statusform"),e.$message({type:"success",message:"变更成功!"})}})})},changeRoleBefore:function(e,t){this.roletext.name=e.Name,this.roleform.id=e.ID;var r=[],i=!0,a=!1,s=void 0;try{for(var l,n=o()(e.RoleIds?e.RoleIds.split(","):[]);!(i=(l=n.next()).done);i=!0){var d=l.value;r.push(parseInt(d))}}catch(e){a=!0,s=e}finally{try{!i&&n.return&&n.return()}finally{if(a)throw s}}this.activeIndex=t,this.roleform.roles=r,this.roleFormVisible=!0},changeRole:function(){var e=this;this.loadingBtnState.changeRoleState=!0,this.ajax("设置角色",this.roleform,function(t,r){if(e.loadingBtnState.changeRoleState=!1,null===t)e.$message({message:r.msg,type:"error"});else{e.roleFormVisible=!1;var i=[],a=!0,s=!1,l=void 0;try{for(var n,d=o()(e.roleList);!(a=(n=d.next()).done);a=!0){var c=n.value,m=!0,u=!1,f=void 0;try{for(var g,p=o()(e.roleform.roles);!(m=(g=p.next()).done);m=!0){var h=g.value;c.ID===h&&i.push(c.Name)}}catch(r){u=!0,f=r}finally{try{!m&&p.return&&p.return()}finally{if(u)throw f}}}}catch(r){s=!0,l=r}finally{try{!a&&d.return&&d.return()}finally{if(s)throw l}}e.userList[e.activeIndex].RoleIds=e.roleform.roles.join(","),e.userList[e.activeIndex].RoleNames=i.join(","),e.activeIndex="",e.resetForm("roleform"),e.$message({type:"success",message:"设置成功!"})}})},changeOrgBefore:function(){this.options.multipleSelection.length>0?(this.orgform.uids=this.options.multipleSelection,this.orgFormVisible=!0):this.$message({type:"warning",message:"请选择要变更组织的用户!"})},changeOrg:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loadingBtnState.changeOrgState=!0,e.ajax("变更用户组织",e.orgform,function(t,r){if(e.loadingBtnState.changeOrgState=!1,null===t)e.$message({message:r.msg,type:"error"});else{e.orgFormVisible=!1;var i="",a=!0,s=!1,l=void 0;try{for(var n,d=o()(e.orgList);!(a=(n=d.next()).done);a=!0){var c=n.value;c.ID===e.orgform.orgid&&(i=c.Name)}}catch(r){s=!0,l=r}finally{try{!a&&d.return&&d.return()}finally{if(s)throw l}}var m=!0,u=!1,f=void 0;try{for(var g,p=o()(e.options.multipleSelectionIndex);!(m=(g=p.next()).done);m=!0){var h=g.value;e.userList[h].OrgID=e.orgform.orgid,e.userList[h].OrgName=i}}catch(r){u=!0,f=r}finally{try{!m&&p.return&&p.return()}finally{if(u)throw f}}e.resetForm("orgform"),e.$message({type:"success",message:"变更成功!"})}})})},editUser:function(e,t){this.activeIndex=t,this.editform.orgid=e.OrgID,this.editform.id=e.ID,this.editform.name=e.Name,this.editform.username=e.UserName,this.editform.status=e.Status,this.editform.type=e.IsManage,this.editform.jobno=e.JobNO,this.editFormVisible=!0},noChange:function(){var e=this.userList[this.activeIndex],t=this.editform;return e.OrgID===t.orgid&&e.Status===t.status&&e.Name===t.name&&e.UserName===t.username&&e.IsManage===t.type&&e.JobNO===t.jobno&&e.ID===t.id&&(this.resetForm("editform"),this.activeIndex="",this.editFormVisible=!1,!0)},editUserHandle:function(){var e=this;this.$refs.editform.validate(function(t){if(!t)return!1;e.noChange()||(e.loadingBtnState.editState=!0,e.ajax("编辑用户",e.editform,function(t,r){e.loadingBtnState.editState=!1,null===t?e.$message({message:r.msg,type:"error"}):(e.editFormVisible=!1,e.userList[e.activeIndex].Name=e.editform.name,e.userList[e.activeIndex].Status=e.editform.status,e.userList[e.activeIndex].IsManage=e.editform.type,e.userList[e.activeIndex].OrgID=e.editform.orgid,e.resetForm("editform"),e.activeIndex="",e.$message({type:"success",message:"修改成功!"}))}))})},orgFormat:function(e){var t=!0,r=!1,i=void 0;try{for(var a,s=o()(this.orgList);!(t=(a=s.next()).done);t=!0){var l=a.value;if(l.ID===e)return l.Name}}catch(e){r=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(r)throw i}}},removeUser:function(e,t){var r=this,i={ids:[]},o=0;if(t||0===t)o=1,i.ids.push(e.ID);else{if(!(this.options.multipleSelection.length>0))return void this.$message({type:"warning",message:"请选择要删除的用户!"});o=this.options.multipleSelection.length,i.ids=this.options.multipleSelection}this.$confirm("确定要删除用户吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.ajax("删除用户",i,function(e,t){null===e?r.$message({message:t.msg,type:"error"}):(r.userList.length-o<=0&&r.pageindex>1&&r.pageindex--,r.$message({type:"success",message:"删除成功!"}),r.reload())})}).catch(function(e){"cancel"!==e&&r.$message({type:"error",message:"系统错误,请联系管理员!"+e})})}},computed:{tableData:function(){var e=[],t=!0,r=!1,i=void 0;try{for(var a,l=o()(this.userList);!(t=(a=l.next()).done);t=!0){var n=a.value,d=s()({},n);d.OrgIDStr=this.orgFormat(d.OrgID),d.CreateTimeStr=u(d.CreateTime),d.UpdateTimeStr=u(d.UpdateTime),d.LastLoginTimeStr=u(d.LastLoginTime),d.IsManageStr=f(d.IsManage),d.StatusStr=g(d.Status),d.buttons=[{show:"编辑用户",type:"primary",icon:"el-icon-edit",title:"编辑",fun:"editUser"},{show:"设置角色",type:"warning",icon:"el-icon-setting",title:"设置角色",fun:"changeRoleBefore"},{show:"删除用户",type:"danger",icon:"el-icon-delete",title:"删除",fun:"removeUser"}],e.push(d)}}catch(e){r=!0,i=e}finally{try{!t&&l.return&&l.return()}finally{if(r)throw i}}return e}}},h={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-row",[r("el-col",{staticClass:"pd10",attrs:{span:4}},[r("span",{staticClass:"activeOrg"},[e._v("组织:"+e._s(e.activeOrg.name))])]),e._v(" "),e.show["组织用户列表"]?r("el-col",{staticClass:"pd10",attrs:{span:20}},[r("el-form",{ref:"form",staticClass:"demo-form-inline",attrs:{inline:!0,model:e.form,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"姓名",size:"mini",prop:"name"}},[r("el-input",{attrs:{maxlength:"20",placeholder:"姓名"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"账号",size:"mini",prop:"username"}},[r("el-input",{attrs:{maxlength:"20",placeholder:"账号"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"工号",size:"mini",prop:"jobno"}},[r("el-input",{attrs:{maxlength:"12",placeholder:"工号"},model:{value:e.form.jobno,callback:function(t){e.$set(e.form,"jobno",t)},expression:"form.jobno"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"入职状态",size:"mini",prop:"status"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.empType,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"账号类型",size:"mini",prop:"ismanage"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.ismanage,callback:function(t){e.$set(e.form,"ismanage",t)},expression:"form.ismanage"}},e._l(e.accountType,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.searchState},on:{click:e.reload}},[e._v("查询")]),e._v(" "),r("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.resetForm("form")}}},[e._v("重置")])],1)],1)],1):e._e()],1),e._v(" "),r("el-row",[r("el-col",{staticClass:"pd10",attrs:{span:24}},[e.show["添加用户"]?r("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.addBefore}},[e._v("添加")]):e._e(),e._v(" "),e.show["变更用户状态"]?r("el-button",{attrs:{type:"warning",icon:"el-icon-edit",disabled:!e.options.multipleSelection.length},on:{click:e.changeStatusBefore}},[e._v("状态变更")]):e._e(),e._v(" "),e.show["变更用户组织"]?r("el-button",{attrs:{type:"primary",icon:"el-icon-edit",disabled:!e.options.multipleSelection.length},on:{click:e.changeOrgBefore}},[e._v("组织变更")]):e._e(),e._v(" "),e.show["删除用户"]?r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",disabled:!e.options.multipleSelection.length},on:{click:e.removeUser}},[e._v("删除")]):e._e()],1)],1),e._v(" "),r("el-row",[r("el-col",{staticClass:"pd10",attrs:{span:24}},[r("my-table",{attrs:{tableFormat:e.tableFormat,data:e.tableData,options:e.options,show:e.show},on:{editUser:e.editUser,changeRoleBefore:e.changeRoleBefore,removeUser:e.removeUser}}),e._v(" "),r("el-pagination",{attrs:{align:"center",background:"","current-page":e.pageindex,"page-size":e.pagesize,layout:"total, prev, pager, next",total:e.userCount},on:{"current-change":e.currentChange}})],1)],1),e._v(" "),e.show["添加用户"]?r("el-dialog",{attrs:{title:"添加用户",visible:e.addFormVisible,"before-close":e.confirmClose},on:{"update:visible":function(t){e.addFormVisible=t},close:function(t){e.resetForm("addform")}}},[r("el-form",{ref:"addform",attrs:{model:e.addform,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"所属组织",prop:"orgid"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择所属组织"},model:{value:e.addform.orgid,callback:function(t){e.$set(e.addform,"orgid",t)},expression:"addform.orgid"}},e._l(e.orgList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"姓名",prop:"name"}},[r("el-input",{model:{value:e.addform.name,callback:function(t){e.$set(e.addform,"name",t)},expression:"addform.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"账号",prop:"username"}},[r("el-input",{model:{value:e.addform.username,callback:function(t){e.$set(e.addform,"username",t)},expression:"addform.username"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"工号",prop:"jobno"}},[r("el-input",{model:{value:e.addform.jobno,callback:function(t){e.$set(e.addform,"jobno",t)},expression:"addform.jobno"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色",prop:"roles"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择角色"},model:{value:e.addform.roles,callback:function(t){e.$set(e.addform,"roles",t)},expression:"addform.roles"}},e._l(e.roleList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"入职状态",prop:"status"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择入职状态"},model:{value:e.addform.status,callback:function(t){e.$set(e.addform,"status",t)},expression:"addform.status"}},e._l(e.empType,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"账号类型",prop:"type"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择账号类型"},model:{value:e.addform.type,callback:function(t){e.$set(e.addform,"type",t)},expression:"addform.type"}},e._l(e.accountType,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.addState},on:{click:e.addUser}},[e._v("保 存")])],1)],1):e._e(),e._v(" "),e.show["编辑用户"]?r("el-dialog",{attrs:{title:"编辑用户",visible:e.editFormVisible},on:{"update:visible":function(t){e.editFormVisible=t},close:function(t){e.resetForm("editform")}}},[r("el-form",{ref:"editform",attrs:{model:e.editform,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"账号",prop:"username"}},[r("span",[e._v(e._s(e.editform.username))])]),e._v(" "),r("el-form-item",{attrs:{label:"工号",prop:"jobno"}},[r("span",[e._v(e._s(e.editform.jobno))])]),e._v(" "),r("el-form-item",{attrs:{label:"所属组织",prop:"orgid"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择所属组织"},model:{value:e.editform.orgid,callback:function(t){e.$set(e.editform,"orgid",t)},expression:"editform.orgid"}},e._l(e.orgList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"姓名",prop:"name"}},[r("el-input",{model:{value:e.editform.name,callback:function(t){e.$set(e.editform,"name",t)},expression:"editform.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"入职状态",prop:"status"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择入职状态"},model:{value:e.editform.status,callback:function(t){e.$set(e.editform,"status",t)},expression:"editform.status"}},e._l(e.empType,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"账号类型",prop:"type"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择账号类型"},model:{value:e.editform.type,callback:function(t){e.$set(e.editform,"type",t)},expression:"editform.type"}},e._l(e.accountType,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.editFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.editState},on:{click:e.editUserHandle}},[e._v("保 存")])],1)],1):e._e(),e._v(" "),e.show["变更用户状态"]?r("el-dialog",{attrs:{title:"状态变更",visible:e.statusFormVisible},on:{"update:visible":function(t){e.statusFormVisible=t},close:function(t){e.resetForm("statusform")}}},[r("el-form",{ref:"statusform",attrs:{rules:e.rules,model:e.statusform,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"入职状态",prop:"status"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择入职状态"},model:{value:e.statusform.status,callback:function(t){e.$set(e.statusform,"status",t)},expression:"statusform.status"}},e._l(e.empType,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.statusFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.changeStatusState},on:{click:e.changeStatus}},[e._v("保 存")])],1)],1):e._e(),e._v(" "),e.show["变更用户组织"]?r("el-dialog",{attrs:{title:"组织变更",visible:e.orgFormVisible},on:{"update:visible":function(t){e.orgFormVisible=t},close:function(t){e.resetForm("orgform")}}},[r("el-form",{ref:"orgform",attrs:{rules:e.rules,model:e.orgform,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"所属组织",prop:"orgid"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择所属组织"},model:{value:e.orgform.orgid,callback:function(t){e.$set(e.orgform,"orgid",t)},expression:"orgform.orgid"}},e._l(e.orgList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.orgFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.changeOrgState},on:{click:e.changeOrg}},[e._v("保 存")])],1)],1):e._e(),e._v(" "),e.show["设置角色"]?r("el-dialog",{attrs:{title:"设置角色",visible:e.roleFormVisible},on:{"update:visible":function(t){e.roleFormVisible=t},close:function(t){e.resetForm("roleform")}}},[r("el-form",{ref:"roleform",attrs:{rules:e.rules,model:e.roleform,"label-width":"80px"}},[r("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"姓名"}},[r("span",[e._v(e._s(e.roletext.name))])]),e._v(" "),r("el-form-item",{attrs:{label:"角色",prop:"roles"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择角色"},model:{value:e.roleform.roles,callback:function(t){e.$set(e.roleform,"roles",t)},expression:"roleform.roles"}},e._l(e.roleList,function(e){return r("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.roleFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.changeRoleState},on:{click:e.changeRole}},[e._v("保 存")])],1)],1):e._e()],1)},staticRenderFns:[]};var v={render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-row",[t("el-col",{staticClass:"pd10",attrs:{span:24}},[t("el-tree",{attrs:{data:this.orgTree,"node-key":"id","expand-on-click-node":!1,"highlight-current":!0,"default-expand-all":"",props:this.defaultProps},on:{"node-click":this.handleOrgClick}})],1)],1)},staticRenderFns:[]};var b={components:{orgTree:n,orgList:m,userList:r("VU/8")(p,h,!1,function(e){r("pCjU")},"data-v-77053f5f",null).exports,userInfoList:r("VU/8")({props:["orgTree","defaultProps"],methods:{handleOrgClick:function(e){this.$emit("getList",e.id)}}},v,!1,function(e){r("vzAq")},"data-v-5f9905d7",null).exports},data:function(){return{treeloading:!1,orgListLoading:!1,userListLoading:!1,userInfoListLoading:!1,collapse:{status:!0,icon:"el-icon-d-arrow-left"},tab:"1",topOrg:{},activeOrg:{},userForm:{},orgTree:[],orgList:[],allOrgList:[],userList:[],userCount:0,roleList:[],defaultRole:[],defaultProps:{children:"children",label:"Name"},show:{"组织列表":!1,"组织用户列表":!1}}},created:function(){this.init()},methods:{init:function(){this.topOrg=this.storage.get("userOrg"),this.getOrgTree(),this.getList(),this.getRoleList(),this.ifshow(this.show)},iscollapse:function(){var e=document.getElementById("tree"),t=document.getElementById("table-list");e.style.width="3%"===e.style.width?"20%":"3%",t.style.width="97%"===t.style.width?"80%":"97%",this.collapse.status=!this.collapse.status,this.collapse.icon="el-icon-d-arrow-left"===this.collapse.icon?"el-icon-d-arrow-right":"el-icon-d-arrow-left"},settab:function(e){this.tab=e.name,this.getList(this.activeOrg)},getRoleList:function(){var e=this;this.ajax("角色列表",{},function(t,r){null===t?e.$message({message:r.msg,type:"error"}):e.roleList=t.data})},getOrgTree:function(){this.treeloading=!0,this.ajax("组织列表",{organizationid:this.topOrg.id},this.getOrgTreeCB)},getOrgTreeCB:function(e,t){if(this.treeloading=!1,null===e)this.$message({message:t.msg,type:"error"});else{this.allOrgList=e.data;var r={};for(var i in e.data)r[i]=e.data[i];this.orgTree=this.formatOrgs(r,this.topOrg.pid)}},formatOrgs:function(e,t){var r=[];for(var i in e)e[i].ParentID===t&&(r.push(e[i]),delete e[i],r[r.length-1].children=this.formatOrgs(e,r[r.length-1].ID));return r},getList:function(e){switch(this.activeOrg=e||this.topOrg,this.tab){case"1":this.getOrgList();break;case"2":this.getRoleByOrgID(),this.getUserList();break;case"3":this.getUserInfoList();break;default:this.$message({message:"非法操作!",type:"error"})}},getOrgList:function(){var e=this;this.orgListLoading=!0,this.ajax("组织列表",{organizationid:this.activeOrg.id},function(t,r){e.orgListLoading=!1,null===t?e.$message({message:r.msg,type:"error"}):e.orgList=t.data})},searchUser:function(e){this.$refs.userList.loadingBtnState.searchState=!0,this.userForm=e,this.getUserList()},getUserList:function(){var e=this;this.userListLoading=!0,this.ajax("组织用户列表",s()({orgid:this.activeOrg.id},this.userForm),function(t,r){e.$refs.userList.loadingBtnState.searchState=!1,e.userListLoading=!1,null===t?e.$message({message:r.msg,type:"error"}):(e.userList=t.data.result,e.userCount=t.data.count)})},getRoleByOrgID:function(){var e=this;this.ajax("默认角色",{id:this.activeOrg.id},function(t,r){if(null===t)e.$message({message:r.msg,type:"error"});else if(t.data[0]){var i=t.data[0].RoleIDs.split(",");for(var o in i)i[o]=parseInt(i[o]);e.defaultRole=i}else e.defaultRole=[]})},removeActiveOrg:function(){var e=!0,t=!1,r=void 0;try{for(var i,a=o()(this.allOrgList);!(e=(i=a.next()).done);e=!0){var s=i.value;if(this.activeOrg.pid===s.ID){this.activeOrg.id=s.ID,this.activeOrg.name=s.Name,this.activeOrg.pid=s.ParentID,this.getOrgList(),this.getOrgTree();break}}}catch(e){t=!0,r=e}finally{try{!e&&a.return&&a.return()}finally{if(t)throw r}}},getUserInfoList:function(e){}}},y={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",[r("el-col",{staticClass:"border tree",staticStyle:{position:"relative","min-height":"40px"},attrs:{id:"tree"}},[r("el-button",{staticStyle:{float:"right",position:"absolute",right:"10px","z-index":"1"},attrs:{type:"text",icon:e.collapse.icon},on:{click:e.iscollapse}}),e._v(" "),r("el-collapse-transition",[r("org-tree",{directives:[{name:"show",rawName:"v-show",value:e.collapse.status,expression:"collapse.status"},{name:"loading",rawName:"v-loading",value:e.treeloading,expression:"treeloading"}],attrs:{orgTree:e.orgTree,defaultProps:e.defaultProps},on:{getList:e.getList}})],1)],1),e._v(" "),r("el-col",{staticClass:"border table-list",attrs:{id:"table-list"}},[r("el-tabs",{staticStyle:{"border-left":"1px solid #eee"},attrs:{type:"card",value:e.tab},on:{"tab-click":e.settab}},[r("el-tab-pane",{attrs:{label:"组织列表",name:"1"}},[e.show["组织列表"]?r("org-list",{directives:[{name:"loading",rawName:"v-loading",value:e.orgListLoading,expression:"orgListLoading"}],attrs:{roleList:e.roleList,activeOrg:e.activeOrg,orgList:e.orgList,allOrgList:e.allOrgList},on:{getOrgList:e.getOrgList,getOrgTree:e.getOrgTree,removeActiveOrg:e.removeActiveOrg}}):e._e()],1),e._v(" "),r("el-tab-pane",{attrs:{label:"用户列表",name:"2"}},[e.show["组织用户列表"]?r("user-list",{directives:[{name:"loading",rawName:"v-loading",value:e.userListLoading,expression:"userListLoading"}],ref:"userList",attrs:{roleList:e.roleList,activeOrg:e.activeOrg,userList:e.userList,defaultRole:e.defaultRole,userCount:e.userCount,orgList:e.allOrgList},on:{searchUser:e.searchUser,orgFormat:e.orgFormat}}):e._e()],1)],1)],1)],1)},staticRenderFns:[]};var _=r("VU/8")(b,y,!1,function(e){r("fJJ4")},"data-v-4ef2bb1e",null);t.default=_.exports},fJJ4:function(e,t){},okdh:function(e,t){},pCjU:function(e,t){},vzAq:function(e,t){},woOf:function(e,t,r){e.exports={default:r("V3tA"),__esModule:!0}}});