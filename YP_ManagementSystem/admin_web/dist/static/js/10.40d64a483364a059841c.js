webpackJsonp([10],{Dd8w:function(e,i,t){"use strict";i.__esModule=!0;var s,r=t("woOf"),n=(s=r)&&s.__esModule?s:{default:s};i.default=n.default||function(e){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e}},R4wc:function(e,i,t){var s=t("kM2E");s(s.S+s.F,"Object",{assign:t("To3L")})},To3L:function(e,i,t){"use strict";var s=t("lktj"),r=t("1kS7"),n=t("NpIQ"),o=t("sB3e"),a=t("MU5D"),l=Object.assign;e.exports=!l||t("S82l")(function(){var e={},i={},t=Symbol(),s="abcdefghijklmnopqrst";return e[t]=7,s.split("").forEach(function(e){i[e]=e}),7!=l({},e)[t]||Object.keys(l({},i)).join("")!=s})?function(e,i){for(var t=o(e),l=arguments.length,m=1,c=r.f,p=n.f;l>m;)for(var d,u=a(arguments[m++]),f=c?s(u).concat(c(u)):s(u),h=f.length,g=0;h>g;)p.call(u,d=f[g++])&&(t[d]=u[d]);return t}:l},V3tA:function(e,i,t){t("R4wc"),e.exports=t("FeBl").Object.assign},ra2v:function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=t("Dd8w"),r=t.n(s),n=t("BO1k"),o=t.n(n),a=Vue.filter("formatMenu"),l=Vue.filter("formatDelflag"),m={data:function(){return{tableFormat:[{prop:"Name",label:"权限名称"},{prop:"Description",label:"权限描述"},{prop:"Url",label:"路径"},{prop:"ParentName",label:"上级权限"},{prop:"TypeStr",label:"权限类型"},{prop:"DeflagStr",label:"权限状态"}],options:{button:!0,maxButtons:3},permissionData:[],childPermissionData:[],permissionSelectData:[],filePermissionSelectData:[],pageindex:1,pagesize:10,permissionsTotal:0,permissionType:[],defaultProps:{children:"children",label:"Name"},permissionFormChildState:{permissionTypeState:!1},checkTree:{},dialogFormVisible:!1,permissionForm:{id:0,parentid:"",name:"",url:"",description:"",type:"",resourceIndex:0},rules:{name:[{required:!0,message:"请输入权限名称",trigger:"blur"},{min:0,max:30,message:"权限名称不要超过 30 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}],url:[{required:!0,message:"请输入路径",trigger:"blur"},{min:0,max:100,message:"路径不要超过 100 个字符",trigger:"blur"}],parentid:[{required:!0,message:"请选择上级权限",trigger:"change"}],description:[{min:0,max:60,message:"描述不要超过 60 个字符",trigger:"blur"}]},formLabelWidth:"120px",show:{"当前权限及其子权限列表":!1,"权限生效及失效":!1,"权限列表":!1,"添加权限":!1,"编辑权限":!1,"删除权限":!1},loadingBtnState:{submitPermissionState:!1}}},computed:{tableData:function(){var e=[],i=!0,t=!1,s=void 0;try{for(var n,m=o()(this.childPermissionData);!(i=(n=m.next()).done);i=!0){var c=n.value,p=r()({},c);switch(p.DeflagStr=l(p.Deflag),p.TypeStr=a(p.Type),p.Deflag){case 1:p.buttons=[{show:"编辑权限",type:"primary",icon:"el-icon-edit",title:"编辑",fun:"handleEdit"},{show:"权限生效及失效",type:"success",icon:"el-icon-circle-check-outline",title:"生效",fun:"enablePermissions"},{show:"删除权限",type:"danger",icon:"el-icon-delete",title:"删除",fun:"deletePermissions"}];break;case 0:p.buttons=[{show:"编辑权限",type:"primary",icon:"el-icon-edit",title:"编辑",fun:"handleEdit"},{show:"权限生效及失效",type:"warning",icon:"el-icon-circle-close-outline",title:"失效",fun:"disablePermissions"},{show:"删除权限",type:"danger",icon:"el-icon-delete",title:"删除",fun:"deletePermissions"}]}e.push(p)}}catch(e){t=!0,s=e}finally{try{!i&&m.return&&m.return()}finally{if(t)throw s}}return e}},created:function(){this.createdinit()},methods:{createdinit:function(){var e=this;this.ifshow(this.show),this.getDic("权限类型",function(i){e.permissionType=i})},currentChange:function(e){this.pageindex=e||1,this.reload()},reload:function(){this.getChildPermissions(this.checkTree.ID,(this.pageindex-1)*this.pagesize,this.pagesize)},resetForm:function(){for(var e in this.$refs.permissionForm.resetFields(),this.permissionForm)this.permissionForm[e]=""},typeChange:function(e){switch(this.permissionForm.parentid="",this.permissionForm.url="",e){case 0:this.filePermissionSelectData=this.permissionSelectData.filter(function(e){return 0===e.ParentID});break;case 1:this.filePermissionSelectData=this.permissionSelectData.filter(function(e){return 0==e.Type&&0!==e.ParentID});break;case 2:this.filePermissionSelectData=this.permissionSelectData.filter(function(e){return 1==e.Type})}},beforHandAddBtn:function(){this.dialogFormVisible=!0,this.permissionFormChildState.permissionTypeState=!1},handleNodeClick:function(e){this.checkTree=e,this.pageindex=1,this.reload()},getChildPermissions:function(e,i,t){var s=this;s.ajax("当前权限及其子权限列表",{id:e,start:i,size:t},function(e,i){null===e?s.$message({message:i.msg,type:"error"}):(s.childPermissionData=e.data.result,s.permissionsTotal=e.data.count)})},handleEdit:function(e,i){this.permissionFormChildState.permissionTypeState=!0,this.permissionForm.id=e.ID,this.permissionForm.name=e.Name,this.permissionForm.type=e.Type,this.permissionForm.resourceIndex=i,this.permissionForm.description=e.Description,this.typeChange(e.Type),this.permissionForm.url=e.Url,this.permissionForm.parentid=e.ParentID,this.dialogFormVisible=!0},enablePermissions:function(e,i){1==e.Deflag&&this.stateChange(0,e.ID,i)},stateChange:function(e,i,t){var s=this;i<0?this.$message({message:"未选中数据",type:"warning"}):this.ajax("权限生效及失效",{deflag:e,id:i},function(e,i){null===e?s.$message({message:i.msg,type:"error"}):(s.$message({message:"操作成功",type:"success"}),s.getChildPermissions(s.checkTree.ID,(s.pageindex-1)*s.pagesize,s.pagesize))})},disablePermissions:function(e,i){var t=this;1!==e.Deflag&&this.$confirm("此操作将失效当前权限下的所有子权限，所有角色将无法访问失效的权限, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.stateChange(1,e.ID,i)}).catch(function(e){"cancel"!==e&&t.$message({type:"error",message:"系统错误,请联系管理员!"+e})})},deletePermissions:function(e,i){var t=this;this.$confirm("此操作将永久删除此权限,不可恢复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i=t;i.ajax("删除权限",{id:e.ID},function(t,s){null===t?i.$message({message:s.msg,type:"error"}):(i.pageindex>1&&i.permissionsTotal-(i.pageindex-1)*i.pagesize==1&&i.pageindex--,i.init(),i.getChildPermissions(i.checkTree.ID==e.ID?e.ParentID:i.checkTree.ID,(i.pageindex-1)*i.pagesize,i.pagesize),i.$message({type:"success",message:"删除成功"}))})}).catch(function(e){"cancel"!==e&&t.$message({type:"error",message:"系统错误,请联系管理员!"+e})})},submitPermission:function(){var e=this;this.$refs.permissionForm.validate(function(i){var t=e;if(!i)return!1;e.loadingBtnState.submitPermissionState=!0,t.permissionForm.id>0?t.ajax("编辑权限",t.permissionForm,function(e,i){t.loadingBtnState.submitPermissionState=!1,null===e?t.$message({message:i.msg,type:"error"}):(t.childPermissionData[t.permissionForm.resourceIndex].Name=t.permissionForm.name,t.childPermissionData[t.permissionForm.resourceIndex].Description=t.permissionForm.description,t.childPermissionData[t.permissionForm.resourceIndex].Url=t.permissionForm.url,t.childPermissionData[t.permissionForm.resourceIndex].ParentName=t.filePermissionSelectData.find(function(e){return e.ID===t.permissionForm.parentid}).Name,t.childPermissionData[t.permissionForm.resourceIndex].ParentID=parseInt(t.permissionForm.parentid),t.init(),t.$message({type:"success",message:"修改成功"}),t.dialogFormVisible=!1)}):t.ajax("添加权限",t.permissionForm,function(e,i){t.loadingBtnState.submitPermissionState=!1,null===e?t.$message({message:i.msg,type:"error"}):(t.$message({type:"success",message:"添加成功"}),t.dialogFormVisible=!1,t.init(),t.pageindex=0,t.getChildPermissions(t.permissionForm.parentid,(t.pageindex-1)*t.pagesize,t.pagesize))})})},formatPermissions:function(e,i){var t=[];for(var s in e)e[s].ParentID===i&&(t.push(e[s]),delete e[s],t[t.length-1].children=this.formatPermissions(e,t[t.length-1].ID));return t},init:function(){var e=this;e.ajax("权限列表",{},function(i,t){if(null===i)e.$message({message:t.msg,type:"error"});else{e.permissionSelectData=i.data;var s={};for(var r in i.data)s[r]=i.data[r];e.permissionData=e.formatPermissions(s,0)}})}},mounted:function(){this.init()}},c={render:function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",[t("el-row",[t("el-col",{staticStyle:{},attrs:{span:5}},[t("div",{staticClass:"border",staticStyle:{height:"100%","background-color":"#fff",padding:"20px 0 20px 20px"}},[e.show["当前权限及其子权限列表"]?t("el-tree",{attrs:{data:e.permissionData,"default-expand-all":"",props:e.defaultProps,accordion:"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}}):e._e()],1)]),e._v(" "),t("el-col",{staticStyle:{"border-left":"1px solid #eee"},attrs:{span:19}},[t("div",{staticClass:"border"},[t("div",{staticStyle:{"margin-left":"5px","background-color":"#fff",height:"100%","text-align":"left"}},[t("div",{staticStyle:{padding:"20px","background-color":"#fff"}},[e.show["添加权限"]?t("el-button",{attrs:{disabled:void 0===e.checkTree.ID,type:"primary"},on:{click:e.beforHandAddBtn}},[e._v("新增")]):e._e()],1),e._v(" "),t("div",{staticClass:"pd20"},[t("my-table",{attrs:{tableFormat:e.tableFormat,data:e.tableData,options:e.options,show:e.show},on:{handleEdit:e.handleEdit,enablePermissions:e.enablePermissions,disablePermissions:e.disablePermissions,deletePermissions:e.deletePermissions}}),e._v(" "),t("el-pagination",{attrs:{align:"center",background:"","current-page":e.pageindex,"page-size":e.pagesize,layout:"total, prev, pager, next",total:e.permissionsTotal},on:{"current-change":e.currentChange}})],1)])])])],1),e._v(" "),t("el-dialog",{attrs:{title:"新增/修改",visible:e.dialogFormVisible},on:{"update:visible":function(i){e.dialogFormVisible=i},close:e.resetForm}},[t("el-form",{ref:"permissionForm",attrs:{model:e.permissionForm,rules:e.rules}},[t("el-form-item",{attrs:{label:"权限名称 ",prop:"name","label-width":e.formLabelWidth}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.permissionForm.name,callback:function(i){e.$set(e.permissionForm,"name",i)},expression:"permissionForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"权限类型",prop:"type","label-width":e.formLabelWidth}},[t("el-select",{attrs:{disabled:e.permissionFormChildState.permissionTypeState},on:{change:e.typeChange},model:{value:e.permissionForm.type,callback:function(i){e.$set(e.permissionForm,"type",i)},expression:"permissionForm.type"}},e._l(e.permissionType,function(e){return t("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"路径 ",prop:"url","label-width":e.formLabelWidth}},[t("el-input",{attrs:{"auto-complete":"off"},model:{value:e.permissionForm.url,callback:function(i){e.$set(e.permissionForm,"url",i)},expression:"permissionForm.url"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"上级权限",prop:"parentid","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"---请选择---"},model:{value:e.permissionForm.parentid,callback:function(i){e.$set(e.permissionForm,"parentid",i)},expression:"permissionForm.parentid"}},e._l(e.filePermissionSelectData,function(e){return t("el-option",{key:e.ID,attrs:{label:e.Name,value:e.ID}})}))],1),e._v(" "),t("el-form-item",{attrs:{label:"权限描述 ",prop:"description","label-width":e.formLabelWidth}},[t("el-input",{attrs:{type:"textarea",rows:2,"auto-complete":"off"},model:{value:e.permissionForm.description,callback:function(i){e.$set(e.permissionForm,"description",i)},expression:"permissionForm.description"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(i){e.dialogFormVisible=!1,e.resetForm()}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary",loading:e.loadingBtnState.submitPermissionState},on:{click:function(i){e.submitPermission()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var p=t("VU/8")(m,c,!1,function(e){t("xE4A")},"data-v-2b9febac",null);i.default=p.exports},woOf:function(e,i,t){e.exports={default:t("V3tA"),__esModule:!0}},xE4A:function(e,i){}});